{% extends "fiesta/base.html" %}

{% load event_tags %}
{% load user_profile %}
{% load utils %}
{% load breadcrumbs %}
{% load i18n %}

{% block head %}
{{form.media}}
{% endblock %}

{% block main %}

{% can_edit event as rights %}
{% if rights  or request.membership.is_privileged %}

<div class="mx-6 p-6 mb-6 mt-6 w-2/7 h-fit rounded-lg bg-base-150 text-left shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)]">
  <h1 class="text-3xl font-semibold mb-4"> Prices </h1>
  {% get_price_variants event as prices %}
  {% if prices is not None %}
  <div class="flex max-[950px]:flex-col">
    {% for price in prices %}
    
      <div id="price-{{ price.pk }}" class="flex-auto flex grid grid-rows-1 grid-cols-2 gap-0 mx-6 p-6 mb-6 mt-6 w-2/7 h-fit rounded-lg bg-base-200 text-left shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)]">
        <div class="flex flex-col">
          <p class="col-start-1 w-fit h-fit">{{ price.title }}</p>
          <p class="col-start-1">{{ price.type }}</p>
          <p class="col-start-1">{{ price.amount }}</p>
        </div>
        <div class="flex flex-col col-start-2 row-span-3 text-right items-end">

          <a href="#" 
          hx-delete="{% url "events:price-delete" event.pk price.pk %}"
          hx-confirm="Are you sure you want to delete this price?"
          hx-headers="{'X-CSRFToken': '{{ csrf_token }}'}"
          hx-target="#price-{{ price.pk }}"
          hx-swap="outerHTML">  
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-9 h-9">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </a>

          <a class="pt-4"
          href="{% url "events:price-update" event.pk price.pk %}"
          x-data="modal($el.href)"
          x-bind="bind">         
            <svg class="h-8 w-8 " fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
            </svg>
          </a>

        </div>
      </div>
    
    {% endfor %}
  </div>
  {% endif %}

  <a class="Forms__button Forms__button--submit"
href="{% url "events:price" event.pk %}"
x-data="modal($el.href)"
x-bind="bind">{% translate "Add price" %}</a>
</div>


<div class="mx-6 p-6 mb-6 mt-6 w-2/7 h-fit rounded-lg bg-base-150 text-left shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)]">
  <h1 class="text-3xl font-semibold mb-4"> Organizers </h1>
  <div id="dropdownUsers" class="pb-6 bg-white rounded-lg">
    <ul class="py-2 text-gray-700 dark:text-gray-200" aria-labelledby="dropdownUsersButton">
      {% for oc in event.organizers.all %}
      <li class="grid grid-cols-2" id="oc-{{oc.pk}}">
        {% get_user_picture oc.user as picture %}
        <a href="#" class="flex items-center px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">
          {% if picture %}
          <img class="w-6 h-6 me-2 rounded-full" src= 'url("{{ picture.url }}")' alt="Jese image">
          {% else %}
          <span class="w-6 h-6 me-2 avatar aspect-square rounded-full text-white text-lg flex flex-row justify-center items-center"
          style="background-color: {{ oc.user.id|get_color_by_text }}">{{ oc.user.first_name|first }}{{ oc.user.last_name|first }}</span>
          {% endif %}
          {{oc.user.first_name}} {{oc.user.last_name}}
        </a>
        <div class="flex">
        <select name="role"  hx-post="{% url 'events:role-change' pk=event.pk pko=oc.pk %}" hx-trigger="change" hx-swap="none">
            {% for role_value, role_display in organizer_roles %}
                <option value="{{ role_value }}" {% if oc.state == role_value %}selected{% endif %}>
                    {{ role_display }}
                </option>
            {% endfor %}
        </select>
        <a href="#" 
        class="pl-6"
        hx-delete="{% url "events:organizer-delete" event.pk oc.pk %}"
        hx-confirm="Are you sure you want to delete this price?"
        hx-headers="{'X-CSRFToken': '{{ csrf_token }}'}"
        hx-target="#oc-{{ oc.pk }}"
        hx-swap="outerHTML">  
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-9 h-9">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </a>
      </div>
      </li>
      {% endfor %}
    </ul>
  </div>
  <a class="Forms__button Forms__button--submit"
  x-data="modal($el.href)"
  x-bind="bind"
  href="{% url "events:organizer-add" event.pk%}">{% trans "Add organizer" %}</a>
</div>

<div class="mx-6 p-6 mb-6 mt-6 w-2/7 h-fit rounded-lg bg-base-150 text-left shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)]">
  <h1 class="text-3xl font-semibold mb-4"> Event </h1>
    <a href="{% url "events:participants" event.id %}" class="Forms__button Forms__button--submit" >{% translate "Show participants" %}</a>

    {%%}
    <button hx-post="{% url "events:event-confirm" event.id %}" hx-swap="none">{% translate "Publish" %}</button>
</div>




{%endif%}

  <div class="md:flex  lg:grid sm:flex grid-rows-2 grid-cols-2 grid-flow-row flex-wrap gap-0 max-lg:hidden pt-6">

    <div class="row-span-2 w-full shrink-0 grow-0 basis-auto  lg:ml-[50px] max-lg:hidden">
      <div class="h-full items-center rounded-lg bg-base-100 p-6 text-left lg:pr-12 lg:text-left shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)]">
        <div class="lg:pr-12">
          <div class="flex">
          <div class="flex-shrink-0">
            <h1 class = "[font-family:'Francois_One-Regular',Helvetica] font-bold text-[30px] tracking-[0] leading-[normal] pr-2">{{ event.title }}</h1>
          </div>
          <div class="flex-grow">
            <a href="{% url "events:event-update" event.id %}" class="button-with-icon">
              <svg class="h-8 w-8 " fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
              </svg>
            </a> 
          </div>
        </div>
        <p class="[font-family:'Francois_One-Regular',Helvetica] font-normal text-[#b3b3b3] text-[15px] tracking-[0] leading-[normal] pb-4"> {{ event.subtitle }} </p>
          Capacity: {{ event.participants.all|length}}/{{ event.capacity }}<br>
          When: {{ event.start.date }}<br>
          Start: {{ event.start.time }} at {{ event.place }}<br>
          {% if event.end != None %}
            End:{{ event.end }}<br>
          {% endif %}
          <div class="flex grid">


          {% get_price_variants event as prices %}
            {% if prices is not None %}
              {% for price in prices %}

                {% if price.type == "free" %}
                
                <p>Free</p>
                {% elif request.user.is_esn_car_holder and price.type == "with_esn_card" %}
                <p>Your price with ESNcard: {{ price.amount }}</p>
                {% elif price.type == "standard"%}
                <p>Your price: {{ price.amount }}</p>
                {% for price in prices %} {% if price.type == "with_esn_card" %} You can pay only this price if you get our ESNcard: {{ price.amount }} {%endif%} {%endfor%}</p>
                
                {% endif %}
              {% endfor %}
            {% endif %}
            </div> 
          <p class="[font-family:'Francois_One-Regular',Helvetica] font-semibold  text-[15px] tracking-[0] leading-[normal] pb-1">Description:</p>
          <p class="pl-2">{{ event.description }}</p>

    

      

          {% if request.membership.is_international %}
          <form action="{% url "events:event-register" event.id %}", method="post">
            {% csrf_token %}
            <button type="submit">Register</button>
          </form>
          
          {% endif %}
        </div>
      </div>
    </div>


    {% if event.landscape_cover.url != '' %} <!-- TODO - if there is no photo -->
    <div class=" z-[10] md:mb-12 w-full shrink-0 grow-0 basis-auto max-lg:hidden">
      <div class="lg:py-12">
        {% if event.landscape_cover %}
        <img src="{{ event.landscape_cover.url }}"
          class="z-[10] w-full rounded-lg shadow-lg dark:shadow-black/20" alt="image" />
        {%endif%}
      </div>
    </div>
    {% endif %}

    <div class=" mt-12 w-full shrink-0 grow-0 basis-auto lg:mb-0 max-lg:hidden">
        <div class="lg:py-12" x-data="mapWidget({ latitude: 49.2071377, longitude: 16.6160413 })" x-init="init">
          <iframe x-bind:src="mapUrl" class="z-[10] w-full h-80 rounded-lg shadow-lg dark:shadow-black/20" ></iframe>
        </div>
    </div>
  </div>


  <div class="flex flex-wrap flex-col gap-0 lg:hidden md:block ">

    {% if event.landscape_cover.url != '' %} <!-- TODO - if there is no photo -->
    <div class="flex z-[10] w-full mb-12 shrink-0 grow-0 basis-auto lg:hidden md:block">
      <div class="lg:py-12">
        {% if event.landscape_cover %}
        <img src="{{ event.landscape_cover.url }}"
          class="z-[10] w-full rounded-lg shadow-lg dark:shadow-black/20" alt="image" />
        {%endif%}
      </div>
    </div>
    {% endif %}

    <div class="row-span-2 w-full shrink-0 grow-0 basis-auto lg:hidden md:block">
      
      <div class=" h-full items-center rounded-lg bg-base-100 p-6 text-left shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)]">
        <div class="mt-[50px] 2">
          <div class="flex">
          <div class="flex-shrink-0">
            <h1 class = "[font-family:'Francois_One-Regular',Helvetica] font-bold text-[40px] tracking-[0] leading-[normal] pr-2">{{ event.title }}</h1>
          </div>
          {% can_edit event as rights %}
          {% if rights %}
          <div class="flex-grow">
            <a href="{% url "events:event-update" event.id %}" class="button-with-icon">
              <svg class="h-8 w-8 " fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/>
              </svg>
            </a> 
          </div>
          {% endif %}
        </div>
        <p class="[font-family:'Francois_One-Regular',Helvetica] font-normal text-[#b3b3b3] text-[15px] tracking-[0] leading-[normal] pb-4"> {{ event.subtitle }} </p>
          Capacity: {{ event.participants.all|length}}/{{ event.capacity }}<br>
          When: {{ event.start.date }}<br>
          Start: {{ event.start.time }} at {{ event.place }}<br>
          {% if event.end != None %}
            End:{{ event.end }}<br>
          {% endif %}
         
          <p class="[font-family:'Francois_One-Regular',Helvetica] font-semibold  text-[15px] tracking-[0] leading-[normal] pb-1">Description:</p>
          <p class="pl-2">{{ event.description }}</p>


          {% if request.membership.is_international %}
            <form action="{% url "events:event-register" event.id %}", method="post">
              {% csrf_token %}
              <button type="submit">Register</button>
            </form>
          {% endif %}

        </div>
      </div>
    </div>

    
    <div class=" mt-12 w-full shrink-0 grow-0 basis-auto lg:mb-0 lg:hidden md:block">
        <div class="lg:py-12" x-data="mapWidget({ latitude: 49.2071377, longitude: 16.6160413 })" x-init="init">
          <iframe x-bind:src="mapUrl" class="z-[10] w-full h-80 rounded-lg shadow-lg dark:shadow-black/20" ></iframe>
        </div>
    </div>

  </div>

{% endblock main %}

